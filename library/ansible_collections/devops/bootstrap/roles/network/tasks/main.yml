---
- name: Check we don't have active {{ default_interface_name }} interface with different mac address
  ansible.builtin.shell: ip a s {{ default_interface_name }} | grep link/ether | awk '{print $2}'
  register: interface_check

- fail:
    msg: "There already is '{{ default_interface_name }}' interface in system with different mac address: {{ interface_check.stdout }}"
  when: interface_check.stdout != "" and interface_check.stdout != mac_address

- name: Put netplan configuration
  ansible.builtin.template:
    src: 50-cloud-init.yaml.j2
    dest: /etc/netplan/50-cloud-init.yaml
  become: yes
  notify:
    - Validate netplan configuration

- name: Get active interface info
  ansible.builtin.shell: ip a s {{ ansible_facts['default_ipv4']['interface'] }}
  register: default_interface_info

- name: Show active interface info
  debug:
    msg: "{{ default_interface_info.stdout }}"
